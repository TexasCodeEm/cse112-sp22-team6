import*as Constants from"../constants.js";const BEST_DAILY_POMO_ID="best-daily-pomo-count",TOTAL_POMO_ID="total-pomo-count",TOTAL_TASK_ID="total-task-count",TODAY_TASK_ID="today-task-count",WEEK_HISTORY="week-history",TODAY_DATE_ID="today",WEEK_START_ID="week-start",TODAY_POMO_ID="today-pomo-count",TOTAL_CYCLE_ID="total-cycle-count",TOTAL_INTERRUPTION="total-interruption",TODAY_INTERRUPTION="today-interruption",ZEROS=[0,0,0,0,0,0,0];function setCounter(t,e){window.localStorage.setItem(t,String(e))}function setDate(t,e){window.localStorage.setItem(t,e.toString())}function setWeekHistory(t){window.localStorage.setItem(WEEK_HISTORY,JSON.stringify(t))}function getCounter(t){return Number(window.localStorage.getItem(t))}function getDate(t){return new Date(window.localStorage.getItem(t)||new Date(0))}function getWeekHistory(){return JSON.parse(window.localStorage.getItem(WEEK_HISTORY))||ZEROS}function incrTasks(){updateStorage(),setCounter(TODAY_TASK_ID,getCounter(TODAY_TASK_ID)+1),setCounter(TOTAL_TASK_ID,getCounter(TOTAL_TASK_ID)+1)}function incrPomoCount(){updateStorage();var t=getCounter(TODAY_POMO_ID)+1;setCounter(TODAY_POMO_ID,t),setCounter(TOTAL_POMO_ID,getCounter(TOTAL_POMO_ID)+1),getCounter(BEST_DAILY_POMO_ID)<t&&setCounter(BEST_DAILY_POMO_ID,t);const e=new Date;t=(e.getDay()-1)%Constants.LENGTH_OF_WEEK;const o=getWeekHistory();o[t]++,setWeekHistory(o)}function incrInterruptions(){updateStorage(),setCounter(TODAY_INTERRUPTION,getCounter(TODAY_INTERRUPTION)+1),setCounter(TOTAL_INTERRUPTION,getCounter(TOTAL_INTERRUPTION)+1)}function updateStorage(){var t;isStorageDateToday()||(setCounter(TODAY_POMO_ID,0),setCounter(TODAY_TASK_ID,0),setCounter(TODAY_INTERRUPTION,0),t=new Date,setDate(TODAY_DATE_ID,t),t=getRecentMonday(t),isSameDay(getDate(WEEK_START_ID),t)||(setDate(WEEK_START_ID,t),setWeekHistory(ZEROS)))}function isStorageDateToday(){return isSameDay(new Date,getDate(TODAY_DATE_ID))}function isSameDay(t,e){var o=t.getDate()===e.getDate(),n=t.getMonth()===e.getMonth(),t=t.getFullYear()===e.getFullYear();return o&&n&&t}function getRecentMonday(t){const e=new Date(t);for(;1!==e.getDay();)e.setDate(e.getDate()-1);return e}export{BEST_DAILY_POMO_ID,TOTAL_POMO_ID,TOTAL_TASK_ID,TODAY_TASK_ID,WEEK_HISTORY,TODAY_DATE_ID,WEEK_START_ID,TODAY_POMO_ID,TOTAL_CYCLE_ID,TOTAL_INTERRUPTION,TODAY_INTERRUPTION,ZEROS,setCounter,setDate,setWeekHistory,getCounter,getDate,getWeekHistory,incrTasks,incrPomoCount,incrInterruptions,updateStorage,isStorageDateToday,isSameDay,getRecentMonday};